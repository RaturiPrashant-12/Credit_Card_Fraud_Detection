{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>{% block title %}Credit Card Fraud Detector{% endblock %}</title>

  <!-- Theme CSS -->
  <link rel="stylesheet" href="{% static 'css/style.css' %}">

  <!-- Inline fallback critical styles -->
  <style>
    /* ensure body BG uses static image first, fallback gradients below */
    body{
      background-image:
        url('{% static "images/background.png" %}'),
        radial-gradient(1200px 800px at 10% -10%, #1f2937 0, transparent 60%),
        linear-gradient(180deg, #0b1220, #0f172a 80%);
      background-size: cover, 1200px 800px, auto;
      background-repeat: no-repeat, no-repeat, no-repeat;
      background-attachment: fixed, scroll, scroll;
      background-position: center center, 10% -10%, center;
    }
  </style>

  {% block head %}{% endblock %}
</head>
<body>
  <header class="topbar container">
    <div class="brand-area">
      <span class="brand">Credit Card Fraud Detector</span>
      <div class="muted small">Secure · Fast · Explainable</div>
    </div>

    <nav class="nav">
      {% if request.user.is_authenticated %}
        <span class="tag">Hi, {{ request.user.username }}</span>
        <a class="btn" href="{% url 'transactions' %}">My Transactions</a>

        <!-- Logout uses POST via hidden form -->
        <a class="btn" href="#" id="logoutBtn">Logout</a>
        <form id="logout-form" method="post" action="{% url 'logout' %}" style="display:none;">
          {% csrf_token %}
          <input type="hidden" name="next" value="{% url 'login' %}">
        </form>
      {% else %}
        <a class="btn btn-primary" href="{% url 'register' %}">Register</a>
        <a class="btn" href="{% url 'login' %}">Login</a>
      {% endif %}
    </nav>
  </header>

  <main class="container" style="padding-top:18px; padding-bottom:36px;">
    <section class="panel">
      <div class="header-hero">
        <div>
          <h1>Credit Card Fraud Detector</h1>
          <p class="sub">
            {% if request.user.is_authenticated %}
              Score a transaction. If flagged as risky, we’ll send an OTP to verify.
            {% else %}
              Create an account or login to use the Credit Card Fraud Detection system.
            {% endif %}
          </p>
        </div>
        <div class="help-pill">
          <span class="pill"><strong>Tip</strong> Use international phone format (+91...)</span>
        </div>
      </div>

      {% if messages %}
        <div class="messages" style="margin-top:10px;">
          {% for message in messages %}
            <div class="msg {{ message.tags|default:'info' }}">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}

      {% block content %}{% endblock %}
    </section>
  </main>

  <footer class="page-footer container">
    <div class="muted small">Built with ❤️ — Keep sensitive data out of public repos.</div>
  </footer>

  <!-- Small JS: attach .input class to Django-rendered inputs/selects so CSS applies -->
  <script>
    document.addEventListener('DOMContentLoaded', ()=> {
      const selectors = 'input, select, textarea';
      document.querySelectorAll(selectors).forEach(el=>{
        // skip hidden inputs and CSRF
        if (el.type === 'hidden') return;
        // if the element already has classes we leave them but ensure 'input' exists
        if (!el.classList.contains('input')) el.classList.add('input');
      });

      const logoutBtn = document.getElementById('logoutBtn');
      if (logoutBtn) logoutBtn.addEventListener('click', (e)=>{
        e.preventDefault();
        document.getElementById('logout-form').submit();
      });
    });
  </script>

  {% block scripts %}{% endblock %}
</body>
</html>
